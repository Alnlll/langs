# 2.1 å˜é‡
## å˜é‡ç»‘å®š
Rustä¸­, `let a = "hello world"` è¢«å®šä¹‰ä¸ºâ€œå˜é‡ç»‘å®šâ€ã€‚
å¦‚æ­¤å‘½åçš„åŸå› ä¸Rustçš„æ ¸å¿ƒåŸåˆ™--æ‰€æœ‰æƒç›¸å…³ï¼Œç»‘å®šå°±æ˜¯æŠŠä¸€ä¸ªå¯¹è±¡ç»‘å®šç»™ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æˆä¸ºäº†å®ƒçš„ä¸»äººï¼ˆåŒæ—¶ä¹Ÿæ„å‘³ç€åŸæœ‰çš„ä¸»äººå¤±å»äº†æ‰€æœ‰æƒï¼‰ã€‚

## å˜é‡å¯å˜æ€§
Rusté»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥é€šè¿‡`mut`å…³é”®å­—æŒ‡å®šä¸ºå¯å˜å˜é‡ã€‚
```rust
fn main() {
    let x = 5;
    println!("The value of x is: {}", x);
    x = 6;
    println!("The value of x is: {}", x);
}

// ##################################
$ cargo run
   Compiling variables v0.1.0 (file:///projects/variables)
error[E0384]: cannot assign twice to immutable variable `x`
 --> src/main.rs:4:5
  |
2 |     let x = 5;
  |         -
  |         |
  |         first assignment to `x`
  |         help: consider making this binding mutable: `mut x`
3 |     println!("The value of x is: {}", x);
4 |     x = 6;
  |     ^^^^^ cannot assign twice to immutable variable

error: aborting due to previous error
```

```rust
fn main() {
    let mut x = 5;
    println!("The value of x is: {}", x);
    x = 6;
    println!("The value of x is: {}", x);
}
```

## å˜é‡è§£æ„
```rust
fn main() {
    let (a, mut b): (bool,bool) = (true, false);
    // a = true,ä¸å¯å˜; b = falseï¼Œå¯å˜
    println!("a = {:?}, b = {:?}", a, b);

    b = true;
    assert_eq!(a, b);
}
```
### ç»“æ„å¼èµ‹å€¼
åœ¨rust 1.59ä¹‹åï¼Œå¯ä»¥åœ¨èµ‹å€¼è¯­å¥çš„å·¦å¼ä¸­ä½¿ç”¨å…ƒç¥–ï¼Œåˆ‡ç‰‡å’Œç»“æ„ä½“æ¨¡å¼äº†ã€‚
```rust
struct Struct {
    e: i32
}

fn main() {
    let (a, b, c, d, e);

    (a, b) = (1, 2);
    // _ ä»£è¡¨åŒ¹é…ä¸€ä¸ªå€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“çš„å€¼æ˜¯ä»€ä¹ˆï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªå˜é‡åè€Œæ˜¯ä½¿ç”¨äº† _
    [c, .., d, _] = [1, 2, 3, 4, 5];
    Struct { e, .. } = Struct { e: 5 };

    assert_eq!([1, 2, 1, 4, 5], [a, b, c, d, e]);
}
```

## å˜é‡å’Œå¸¸é‡
- å¸¸é‡ä¸å…è®¸ä½¿ç”¨`mut`, å¸¸é‡ä¸ä»…é»˜è®¤ä¸å¯å˜ï¼Œè€Œä¸”å§‹ç»ˆä¸å¯å˜ï¼Œå¸¸é‡åœ¨ç¼–è¯‘å®Œæˆåå°±å·²ç»ç¡®è®¤äº†ä»–çš„å€¼ã€‚
- å¸¸é‡ä½¿ç”¨`const`æ¥å£°æ˜ï¼Œå¹¶ä¸”å¿…é¡»æ ‡æ³¨ç±»å‹

```rust
const MAX_POINTS: u32 = 100_000;
```
å¸¸é‡å¯ä»¥åœ¨ä»»æ„ä½œç”¨åŸŸä¸­å£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸï¼Œåœ¨å£°æ˜çš„ä½œç”¨åŸŸå†…ï¼Œå¸¸é‡åœ¨ç¨‹åºè¿è¡Œçš„æ•´ä¸ªè¿‡ç¨‹ä¸­éƒ½æœ‰æ•ˆã€‚

## å˜é‡é®è”½ï¼ˆshadowingï¼‰
Rustå…è®¸å£°æ˜ç›¸åŒçš„å˜é‡ï¼Œåœ¨åé¢å£°æ˜çš„å˜é‡ä¼šé®è”½ï¼ˆshadowingï¼‰å‰é¢å£°æ˜çš„å˜é‡ã€‚
```rust
fn main() {
    let x = 5;
    // åœ¨mainå‡½æ•°çš„ä½œç”¨åŸŸå†…å¯¹ä¹‹å‰çš„xè¿›è¡Œé®è”½
    let x = x + 1;

    {
        // åœ¨å½“å‰çš„èŠ±æ‹¬å·ä½œç”¨åŸŸå†…ï¼Œå¯¹ä¹‹å‰çš„xè¿›è¡Œé®è”½
        let x = x * 2;
        println!("The value of x in the inner scope is: {}", x);
    }

    println!("The value of x is: {}", x);
}
```

# 2.2 åŸºæœ¬ç±»å‹
Rustæ¯ä¸ªå˜é‡éƒ½æœ‰å…¶ç¡®åˆ‡çš„æ•°æ®ç±»å‹ï¼Œé€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼šåŸºæœ¬ç±»å‹å’Œå¤åˆç±»å‹ï¼š
- æ•°å€¼ç±»å‹ï¼šæœ‰ç¬¦å·æ•´æ•° `(i8, i16, i32, i64, isize)`ã€ æ— ç¬¦å·æ•´æ•° `(u8, u16, u32, u64, usize)` ã€æµ®ç‚¹æ•° `(f32, f64)`ã€ä»¥åŠæœ‰ç†æ•°ã€å¤æ•°
- å­—ç¬¦ä¸²ï¼šå­—ç¬¦ä¸²å­—é¢é‡å’Œå­—ç¬¦ä¸²åˆ‡ç‰‡ `&str`
- å¸ƒå°”ç±»å‹ï¼š`true` å’Œ `false`
- å­—ç¬¦ç±»å‹ï¼šè¡¨ç¤ºå•ä¸ª Unicode å­—ç¬¦ï¼Œå­˜å‚¨ä¸º 4 ä¸ªå­—èŠ‚
- å•å…ƒç±»å‹ï¼šå³ () ï¼Œå…¶å”¯ä¸€çš„å€¼ä¹Ÿæ˜¯ ()

## ç±»å‹æ¨å€’ä¸æ ‡æ³¨
ä¸å…¶ä»–åŠ¨æ€è¯­è¨€ä¸åŒï¼ŒRustæ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œç¼–è¯‘å™¨å¿…é¡»åœ¨ç¼–è¯‘æœŸç¡®å®šæ‰€æœ‰å˜é‡çš„ç±»å‹ã€‚ä½†æ˜¯è¿™ä¸æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸€ä¸ªå˜é‡æ ‡æ³¨ç±»å‹ï¼Œç¼–è¯‘å™¨ä¹Ÿå¯ä»¥è¿›è¡Œç±»å‹æ¨å¯¼ã€‚
ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¸èƒ½æ¨å¯¼å‡ºç¡®åˆ‡ç±»å‹çš„æ—¶å€™ï¼Œå°±éœ€è¦æ˜ç¡®çš„æ ‡å‡†ç±»å‹ã€‚

```rust
let guess = "42".parse().expect("Not a number!");

$ cargo build
   Compiling no_type_annotations v0.1.0 (file:///projects/no_type_annotations)
error[E0282]: type annotations needed
 --> src/main.rs:2:9
  |
2 |     let guess = "42".parse().expect("Not a number!");
  |         ^^^^^ consider giving `guess` a type
```

## 2.2.1 æ•°å€¼ç±»å‹
### æ•´æ•°ç±»å‹
é•¿åº¦ | æœ‰ç¬¦å·ç±»å‹ |æ— ç¬¦å·ç±»å‹
-- | -- | --
8 ä½ | i8 | u8
16 ä½ | i16 | u16
32 ä½ | i32 | u32
64 ä½ | i64 | u64
128 ä½ | i128 | u128
è§†æ¶æ„è€Œå®š | isize | usize

æ¯ä¸ªæœ‰ç¬¦å·ç±»å‹è§„å®šçš„æ•°å­—èŒƒå›´æ˜¯ $-(2^{n - 1})$ ~ $ 2^{n - 1} - 1$ï¼Œå…¶ä¸­ n æ˜¯è¯¥å®šä¹‰å½¢å¼çš„ä½é•¿åº¦ã€‚å› æ­¤ `i8`å¯å­˜å‚¨æ•°å­—èŒƒå›´æ˜¯ -128 ~ 127ã€‚æ— ç¬¦å·ç±»å‹å¯ä»¥å­˜å‚¨çš„æ•°å­—èŒƒå›´æ˜¯ 0 ~ $2^n - 1$ï¼Œæ‰€ä»¥ u8 èƒ½å¤Ÿå­˜å‚¨çš„æ•°å­—ä¸º 0 ~ 255ã€‚

æ•°å­—å­—é¢é‡ | ç¤ºä¾‹
-- | --
åè¿›åˆ¶ | 98_222
åå…­è¿›åˆ¶ | 0xff
å…«è¿›åˆ¶ | 0o77
äºŒè¿›åˆ¶ | 0b1111_0000
å­—èŠ‚ (ä»…é™äº u8) | b'A'

### æ•´å½¢æº¢å‡º
åœ¨debugæ¨¡å¼ä¸‹ï¼ŒRustä¼šæ£€æŸ¥æ•´å½¢æº¢å‡ºå¹¶panicã€‚
ä½†æ˜¯åœ¨releaseæ¨¡å¼ä¸‹ï¼ŒRustä¸ä¼šæ£€æµ‹æº¢å‡ºï¼Œè€Œæ˜¯æŒ‰ç…§è¡¥ç å¾ªç¯æº¢å‡ºï¼ˆtwo's complement wrapperï¼‰çš„è§„åˆ™å¤„ç†ã€‚
å¤§äºè¯¥ç±»å‹æœ€å¤§å€¼çš„æ•°å€¼ä¼šè¢«è¡¥ç è½¬åŒ–æˆè¯¥ç±»å‹èƒ½å¤Ÿæ”¯æŒçš„æœ€å°å€¼ï¼Œe.x., `u8`ä¸‹256 -ã€‹ 0ï¼Œ 257 -ã€‹ 1.
å¦‚æœæƒ³è¦æ˜¾å¼å¤„ç†æº¢å‡ºï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•ï¼š
- ä½¿ç”¨ wrapping_* æ–¹æ³•åœ¨æ‰€æœ‰æ¨¡å¼ä¸‹éƒ½æŒ‰ç…§è¡¥ç å¾ªç¯æº¢å‡ºè§„åˆ™å¤„ç†ï¼Œä¾‹å¦‚ `wrapping_add`
- å¦‚æœä½¿ç”¨ checked_* æ–¹æ³•æ—¶å‘ç”Ÿæº¢å‡ºï¼Œåˆ™è¿”å› None å€¼
- ä½¿ç”¨ overflowing_* æ–¹æ³•è¿”å›è¯¥å€¼å’Œä¸€ä¸ªæŒ‡ç¤ºæ˜¯å¦å­˜åœ¨æº¢å‡ºçš„å¸ƒå°”å€¼
- ä½¿ç”¨ saturating_* æ–¹æ³•ï¼Œå¯ä»¥é™å®šè®¡ç®—åçš„ç»“æœä¸è¶…è¿‡ç›®æ ‡ç±»å‹çš„æœ€å¤§å€¼æˆ–ä½äºæœ€å°å€¼ï¼Œä¾‹å¦‚:
```Rust
assert_eq!(100u8.saturating_add(1), 101);
assert_eq!(u8::MAX.saturating_add(127), u8::MAX);
```

## æµ®ç‚¹ç±»å‹
åœ¨ Rust ä¸­æµ®ç‚¹ç±»å‹æ•°å­—ä¹Ÿæœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼š `f32` å’Œ `f64`.
```Rust
fn main() {
    let x = 2.0; // f64
    let y: f32 = 3.0; // f32
}
```
æµ®ç‚¹æ•°ç”±äºåº•å±‚æ ¼å¼çš„ç‰¹æ®Šæ€§ï¼Œå¯¼è‡´äº†å¦‚æœåœ¨ä½¿ç”¨æµ®ç‚¹æ•°æ—¶ä¸å¤Ÿè°¨æ…ï¼Œå°±å¯èƒ½é€ æˆå±é™©ï¼Œæœ‰ä¸¤ä¸ªåŸå› ï¼š
- æµ®ç‚¹æ•°å¾€å¾€æ˜¯ä½ æƒ³è¦æ•°å­—çš„è¿‘ä¼¼è¡¨è¾¾
- æµ®ç‚¹æ•°åœ¨æŸäº›ç‰¹æ€§ä¸Šæ˜¯åç›´è§‰çš„ 

Rust çš„ HashMap æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ä¸ª KV ç±»å‹çš„ Hash Map å®ç°ï¼Œå®ƒå¯¹äº K æ²¡æœ‰ç‰¹å®šç±»å‹çš„é™åˆ¶ï¼Œä½†æ˜¯è¦æ±‚èƒ½ç”¨ä½œ K çš„ç±»å‹å¿…é¡»å®ç°äº† std::cmp::Eq ç‰¹å¾ï¼Œå› æ­¤è¿™æ„å‘³ç€ä½ æ— æ³•ä½¿ç”¨æµ®ç‚¹æ•°ä½œä¸º HashMap çš„ Key.

ä¸ºäº†é¿å…ä¸Šé¢è¯´çš„ä¸¤ä¸ªé™·é˜±ï¼Œä½ éœ€è¦éµå®ˆä»¥ä¸‹å‡†åˆ™ï¼š
- é¿å…åœ¨æµ®ç‚¹æ•°ä¸Šæµ‹è¯•ç›¸ç­‰æ€§
- å½“ç»“æœåœ¨æ•°å­¦ä¸Šå¯èƒ½å­˜åœ¨æœªå®šä¹‰æ—¶ï¼Œéœ€è¦æ ¼å¤–çš„å°å¿ƒ

```rust
fn main() {
    let abc: (f32, f32, f32) = (0.1, 0.2, 0.3);
    let xyz: (f64, f64, f64) = (0.1, 0.2, 0.3);

    println!("abc (f32)");
    println!("   0.1 + 0.2: {:x}", (abc.0 + abc.1).to_bits());
    println!("         0.3: {:x}", (abc.2).to_bits());
    println!();

    println!("xyz (f64)");
    println!("   0.1 + 0.2: {:x}", (xyz.0 + xyz.1).to_bits());
    println!("         0.3: {:x}", (xyz.2).to_bits());
    println!();

    assert!(abc.0 + abc.1 == abc.2);
    assert!(xyz.0 + xyz.1 == xyz.2);
}

abc (f32)
   0.1 + 0.2: 3e99999a
         0.3: 3e99999a

xyz (f64)
   0.1 + 0.2: 3fd3333333333334
         0.3: 3fd3333333333333

thread 'main' panicked at 'assertion failed: xyz.0 + xyz.1 == xyz.2',
â¥ch2-add-floats.rs.rs:14:5
note: run with `RUST_BACKTRACE=1` environment variable to display
â¥a backtrace
```

### NaN
å¯¹äºæ•°å­¦ä¸Šæœªå®šä¹‰çš„ç»“æœï¼Œä¾‹å¦‚å¯¹è´Ÿæ•°å–å¹³æ–¹æ ¹ -42.1.sqrt() ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªç‰¹æ®Šçš„ç»“æœï¼šRust çš„æµ®ç‚¹æ•°ç±»å‹ä½¿ç”¨ NaN (not a number) æ¥å¤„ç†è¿™äº›æƒ…å†µã€‚

æ‰€æœ‰è·Ÿ NaN äº¤äº’çš„æ“ä½œï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ª NaNï¼Œè€Œä¸” NaN ä¸èƒ½ç”¨æ¥æ¯”è¾ƒ.

```rust
fn main() {
  let x = (-42.0_f32).sqrt();
  assert_eq!(x, x);
}

 Compiling playground v0.0.1 (/playground)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.73s
     Running `target/debug/playground`

thread 'main' (12) panicked at src/main.rs:3:3:
assertion `left == right` failed
  left: NaN
 right: NaN
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

## æ•°å­—è¿ç®—
Rust æ”¯æŒæ‰€æœ‰æ•°å­—ç±»å‹çš„åŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–æ¨¡è¿ç®—ã€‚
```rust
fn main() {
  // ç¼–è¯‘å™¨ä¼šè¿›è¡Œè‡ªåŠ¨æ¨å¯¼ï¼Œç»™äºˆtwenty i32çš„ç±»å‹
  let twenty = 20;
  // ç±»å‹æ ‡æ³¨
  let twenty_one: i32 = 21;
  // é€šè¿‡ç±»å‹åç¼€çš„æ–¹å¼è¿›è¡Œç±»å‹æ ‡æ³¨ï¼š22æ˜¯i32ç±»å‹
  let twenty_two = 22i32;

  // åªæœ‰åŒæ ·ç±»å‹ï¼Œæ‰èƒ½è¿ç®—
  let addition = twenty + twenty_one + twenty_two;
  println!("{} + {} + {} = {}", twenty, twenty_one, twenty_two, addition);

  // å¯¹äºè¾ƒé•¿çš„æ•°å­—ï¼Œå¯ä»¥ç”¨_è¿›è¡Œåˆ†å‰²ï¼Œæå‡å¯è¯»æ€§
  let one_million: i64 = 1_000_000;
  println!("{}", one_million.pow(2));

  // å®šä¹‰ä¸€ä¸ªf32æ•°ç»„ï¼Œå…¶ä¸­42.0ä¼šè‡ªåŠ¨è¢«æ¨å¯¼ä¸ºf32ç±»å‹
  let forty_twos = [
    42.0,
    42f32,
    42.0_f32,
  ];

  // æ‰“å°æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå€¼ï¼Œå¹¶æ§åˆ¶å°æ•°ä½ä¸º2ä½
  println!("{:.2}", forty_twos[0]);
}
```

## ä½è¿ç®—

è¿ç®—ç¬¦ | è¯´æ˜
-- | --
& | ç›¸åŒä½ç½®å‡ä¸º1æ—¶åˆ™ä¸º1,å¦åˆ™ä¸º0
ï½œ | ç›¸åŒä½ç½®åªè¦æœ‰1æ—¶åˆ™ä¸º1ï¼Œå¦åˆ™ä¸º0
^ | ç›¸åŒä½ç½®ä¸ç›¸åŒåˆ™ä¸º1ï¼Œç›¸åŒåˆ™ä¸º0
! | æŠŠä½ä¸­çš„0å’Œ1ç›¸äº’å–åï¼Œå³0ç½®ä¸º1ï¼Œ1ç½®ä¸º0
<< å·¦ç§» | æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šä½æ•°ï¼Œå³ä½è¡¥0
">> å³ç§»" | æ‰€æœ‰ä½å‘å³ç§»åŠ¨æŒ‡å®šä½æ•°ï¼Œå¸¦ç¬¦å·ç§»åŠ¨ï¼ˆæ­£æ•°è¡¥0ï¼Œè´Ÿæ•°è¡¥1ï¼‰

```rust
fn main() {
    // æ— ç¬¦å·8ä½æ•´æ•°ï¼ŒäºŒè¿›åˆ¶ä¸º00000010
    let a: u8 = 2; // ä¹Ÿå¯ä»¥å†™ let a: u8 = 0b_0000_0010;

    // äºŒè¿›åˆ¶ä¸º00000011
    let b: u8 = 3;

    // {:08b}ï¼šå·¦é«˜å³ä½è¾“å‡ºäºŒè¿›åˆ¶01ï¼Œä¸è¶³8ä½åˆ™é«˜ä½è¡¥0
    println!("a value is        {:08b}", a);

    println!("b value is        {:08b}", b);

    println!("(a & b) value is  {:08b}", a & b);

    println!("(a | b) value is  {:08b}", a | b);

    println!("(a ^ b) value is  {:08b}", a ^ b);

    println!("(!b) value is     {:08b}", !b);

    println!("(a << b) value is {:08b}", a << b);

    println!("(a >> b) value is {:08b}", a >> b);

    let mut a = a;
    // æ³¨æ„è¿™äº›è®¡ç®—ç¬¦é™¤äº†!ä¹‹å¤–éƒ½å¯ä»¥åŠ ä¸Š=è¿›è¡Œèµ‹å€¼ (å› ä¸º!=è¦ç”¨æ¥åˆ¤æ–­ä¸ç­‰äº)
    a <<= b;
    println!("(a << b) value is {:08b}", a);
}
```

```rust
fn main() {
   let a: u8 = 255;
   let b = a>>7; // ok
   let b = a<<7; // ok
   let b = a>>8; // overflow
   let b = a<<8; // overflow
}
```

## åºåˆ—(Range)
Rust æä¾›äº†ä¸€ä¸ªéå¸¸ç®€æ´çš„æ–¹å¼ï¼Œç”¨æ¥ç”Ÿæˆè¿ç»­çš„æ•°å€¼/
```rust
for i in 1..=5 {
    println!("{}",i);
}
```

åºåˆ—åªå…è®¸ç”¨äºæ•°å­—æˆ–å­—ç¬¦ç±»å‹ï¼ŒåŸå› æ˜¯ï¼šå®ƒä»¬å¯ä»¥è¿ç»­ï¼ŒåŒæ—¶ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå¯ä»¥æ£€æŸ¥è¯¥åºåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå­—ç¬¦å’Œæ•°å­—å€¼æ˜¯ Rust ä¸­ä»…æœ‰çš„å¯ä»¥ç”¨äºåˆ¤æ–­æ˜¯å¦ä¸ºç©ºçš„ç±»å‹

```rust
for i in 'a'..='z' {
    println!("{}",i);
}
```

## ä½¿ç”¨ As å®Œæˆç±»å‹è½¬æ¢
Rust ä¸­å¯ä»¥ä½¿ç”¨ As æ¥å®Œæˆä¸€ä¸ªç±»å‹åˆ°å¦ä¸€ä¸ªç±»å‹çš„è½¬æ¢ï¼Œå…¶æœ€å¸¸ç”¨äºå°†åŸå§‹ç±»å‹è½¬æ¢ä¸ºå…¶ä»–åŸå§‹ç±»å‹ï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥å®Œæˆè¯¸å¦‚å°†æŒ‡é’ˆè½¬æ¢ä¸ºåœ°å€ã€åœ°å€è½¬æ¢ä¸ºæŒ‡é’ˆä»¥åŠå°†æŒ‡é’ˆè½¬æ¢ä¸ºå…¶ä»–æŒ‡é’ˆç­‰åŠŸèƒ½ã€‚


## æœ‰ç†æ•°å’Œå¤æ•°
Rust çš„æ ‡å‡†åº“ç›¸æ¯”å…¶å®ƒè¯­è¨€ï¼Œå‡†å…¥é—¨æ§›è¾ƒé«˜ï¼Œå› æ­¤æœ‰ç†æ•°å’Œå¤æ•°å¹¶æœªåŒ…å«åœ¨æ ‡å‡†åº“ä¸­ï¼š
- æœ‰ç†æ•°å’Œå¤æ•°
- ä»»æ„å¤§å°çš„æ•´æ•°å’Œä»»æ„ç²¾åº¦çš„æµ®ç‚¹æ•°
- å›ºå®šç²¾åº¦çš„åè¿›åˆ¶å°æ•°ï¼Œå¸¸ç”¨äºè´§å¸ç›¸å…³çš„åœºæ™¯

å¥½åœ¨ç¤¾åŒºå·²ç»å¼€å‘å‡ºé«˜è´¨é‡çš„ Rust æ•°å€¼åº“ï¼šnumã€‚

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥å¼•å…¥ num åº“ï¼š
- åˆ›å»ºæ–°å·¥ç¨‹ cargo new complex-num && cd complex-num
- åœ¨ Cargo.toml ä¸­çš„ [dependencies] ä¸‹æ·»åŠ ä¸€è¡Œ num = "0.4.0"
- å°† src/main.rs æ–‡ä»¶ä¸­çš„ main å‡½æ•°æ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç 
- è¿è¡Œ cargo run

```rust
use num::complex::Complex;

 fn main() {
   let a = Complex { re: 2.1, im: -1.2 };
   let b = Complex::new(11.1, 22.2);
   let result = a + b;

   println!("{} + {}i", result.re, result.im)
 }
```

## 2.2.2 å­—ç¬¦ã€å¸ƒå°”ã€å•å…ƒç±»å‹

### å­—ç¬¦ç±»å‹(char)

```rust
fn main() {
    let c = 'z';
    let z = 'â„¤';
    let g = 'å›½';
    let heart_eyed_cat = 'ğŸ˜»';
}
```
Rust çš„å­—ç¬¦ä¸ä»…ä»…æ˜¯ ASCIIï¼Œæ‰€æœ‰çš„ Unicode å€¼éƒ½å¯ä»¥ä½œä¸º Rust å­—ç¬¦ï¼ŒåŒ…æ‹¬å•ä¸ªçš„ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ã€emoji è¡¨æƒ…ç¬¦å·ç­‰ç­‰ï¼Œéƒ½æ˜¯åˆæ³•çš„å­—ç¬¦ç±»å‹ã€‚Unicode å€¼çš„èŒƒå›´ä» U+0000 ~ U+D7FF å’Œ U+E000 ~ U+10FFFFã€‚

ç”±äº Unicode éƒ½æ˜¯ 4 ä¸ªå­—èŠ‚ç¼–ç ï¼Œå› æ­¤å­—ç¬¦ç±»å‹ä¹Ÿæ˜¯å ç”¨ 4 ä¸ªå­—èŠ‚ï¼š
```rust
fn main() {
    let x = 'ä¸­';
    println!("å­—ç¬¦'ä¸­'å ç”¨äº†{}å­—èŠ‚çš„å†…å­˜å¤§å°", size_of_val(&x));
}
```

### å¸ƒå°”(bool)
Rust ä¸­çš„å¸ƒå°”ç±»å‹æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrue å’Œ falseï¼Œå¸ƒå°”å€¼å ç”¨å†…å­˜çš„å¤§å°ä¸º 1 ä¸ªå­—èŠ‚ï¼š
```rust
fn main() {
    let t = true;

    let f: bool = false; // ä½¿ç”¨ç±»å‹æ ‡æ³¨,æ˜¾å¼æŒ‡å®šfçš„ç±»å‹

    if f {
        println!("è¿™æ˜¯æ®µæ¯«æ— æ„ä¹‰çš„ä»£ç ");
    }
}
```

### å•å…ƒç±»å‹(unit)
å•å…ƒç±»å‹å°±æ˜¯ () ,å”¯ä¸€çš„å€¼ä¹Ÿæ˜¯ ().

main å‡½æ•°å°±è¿”å›è¿™ä¸ªå•å…ƒç±»å‹ ()ï¼Œä½ ä¸èƒ½è¯´ main å‡½æ•°æ— è¿”å›å€¼ï¼Œå› ä¸ºæ²¡æœ‰è¿”å›å€¼çš„å‡½æ•°åœ¨ Rust ä¸­æ˜¯æœ‰å•ç‹¬çš„å®šä¹‰çš„ï¼šå‘æ•£å‡½æ•°( diverging functions )ï¼Œé¡¾åæ€ä¹‰ï¼Œæ— æ³•æ”¶æ•›çš„å‡½æ•°ã€‚

() ä½œä¸º map çš„å€¼ï¼Œè¡¨ç¤ºæˆ‘ä»¬ä¸å…³æ³¨å…·ä½“çš„å€¼ï¼Œåªå…³æ³¨ keyã€‚ è¿™ç§ç”¨æ³•å’Œ Go è¯­è¨€çš„ struct{} ç±»ä¼¼ï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªå€¼ç”¨æ¥å ä½ï¼Œä½†æ˜¯å®Œå…¨ä¸å ç”¨ä»»ä½•å†…å­˜ã€‚

# 2.3 æ‰€æœ‰æƒå’Œå€Ÿç”¨
## 2.3.1 æ‰€æœ‰æƒ

æ‰€æœ‰çš„ç¨‹åºéƒ½å¿…é¡»å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œå¦‚ä½•ä»å†…å­˜ä¸­ç”³è¯·ç©ºé—´æ¥å­˜æ”¾ç¨‹åºçš„è¿è¡Œå†…å®¹ï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦çš„æ—¶å€™é‡Šæ”¾è¿™äº›ç©ºé—´ï¼Œæˆäº†é‡ä¸­ä¹‹é‡ï¼Œä¹Ÿæ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€è®¾è®¡çš„éš¾ç‚¹ä¹‹ä¸€ã€‚åœ¨è®¡ç®—æœºè¯­è¨€ä¸æ–­æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†ä¸‰ç§æµæ´¾ï¼š

- **åƒåœ¾å›æ”¶æœºåˆ¶(GC)**ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šJavaã€Go
- **æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾**, åœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ï¼Œå…¸å‹ä»£è¡¨ï¼šC++
- **é€šè¿‡æ‰€æœ‰æƒæ¥ç®¡ç†å†…å­˜**ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—è§„åˆ™è¿›è¡Œæ£€æŸ¥

### æ ˆ(Stack)ä¸å †(Heap)

- æ ˆ(Stack)
  - æ ˆæŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œåè¿›å…ˆå‡ºã€‚
  - å¢åŠ æ•°æ®å«åšè¿›æ ˆï¼Œç§»å‡ºæ•°æ®åˆ™å«åšå‡ºæ ˆã€‚
  - æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å ç”¨å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå‡è®¾æ•°æ®å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆåœ¨å–å‡ºæ•°æ®æ—¶ï¼Œä½ å°†æ— æ³•å–åˆ°ä½ æƒ³è¦çš„æ•°æ®ã€‚

- å †(Heap)
  - å½“å‘å †ä¸Šæ”¾å…¥æ•°æ®æ—¶ï¼Œéœ€è¦è¯·æ±‚ä¸€å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºä½ï¼ŒæŠŠå®ƒæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥ä½ç½®åœ°å€çš„æŒ‡é’ˆï¼Œè¯¥è¿‡ç¨‹è¢«ç§°ä¸ºåœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œæœ‰æ—¶ç®€ç§°ä¸º â€œåˆ†é…â€(allocating)ã€‚
  - æ¥ç€ï¼Œè¯¥æŒ‡é’ˆä¼šè¢«æ¨å…¥æ ˆä¸­ï¼Œå› ä¸ºæŒ‡é’ˆçš„å¤§å°æ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼Œåœ¨åç»­ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä½ å°†é€šè¿‡æ ˆä¸­çš„æŒ‡é’ˆï¼Œæ¥è·å–æ•°æ®åœ¨å †ä¸Šçš„å®é™…å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®è¯¥æ•°æ®ã€‚
  - å †æ˜¯ä¸€ç§ç¼ºä¹ç»„ç»‡çš„æ•°æ®ç»“æ„ã€‚æƒ³è±¡ä¸€ä¸‹å»é¤é¦†å°±åº§åƒé¥­ï¼šè¿›å…¥é¤é¦†ï¼Œå‘ŠçŸ¥æœåŠ¡å‘˜æœ‰å‡ ä¸ªäººï¼Œç„¶åæœåŠ¡å‘˜æ‰¾åˆ°ä¸€ä¸ªå¤Ÿå¤§çš„ç©ºæ¡Œå­ï¼ˆå †ä¸Šåˆ†é…çš„å†…å­˜ç©ºé—´ï¼‰å¹¶é¢†ä½ ä»¬è¿‡å»ã€‚å¦‚æœæœ‰äººæ¥è¿Ÿäº†ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¡Œå·ï¼ˆæ ˆä¸Šçš„æŒ‡é’ˆï¼‰æ¥æ‰¾åˆ°ä½ ä»¬ååœ¨å“ªã€‚

- æ€§èƒ½åŒºåˆ«
  - åœ¨æ ˆä¸Šåˆ†é…å†…å­˜æ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜è¦å¿«ï¼Œå› ä¸ºå…¥æ ˆæ—¶æ“ä½œç³»ç»Ÿæ— éœ€è¿›è¡Œå‡½æ•°è°ƒç”¨ï¼ˆæˆ–æ›´æ…¢çš„ç³»ç»Ÿè°ƒç”¨ï¼‰æ¥åˆ†é…æ–°çš„ç©ºé—´ï¼Œåªéœ€è¦å°†æ–°æ•°æ®æ”¾å…¥æ ˆé¡¶å³å¯
  - åœ¨å †ä¸Šåˆ†é…å†…å­˜åˆ™éœ€è¦æ›´å¤šçš„å·¥ä½œï¼Œè¿™æ˜¯å› ä¸ºæ“ä½œç³»ç»Ÿå¿…é¡»é¦–å…ˆæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå­˜æ”¾æ•°æ®çš„å†…å­˜ç©ºé—´ï¼Œæ¥ç€åšä¸€äº›è®°å½•ä¸ºä¸‹ä¸€æ¬¡åˆ†é…åšå‡†å¤‡ï¼Œå¦‚æœå½“å‰è¿›ç¨‹åˆ†é…çš„å†…å­˜é¡µä¸è¶³æ—¶ï¼Œè¿˜éœ€è¦è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ¥ç”³è¯·æ›´å¤šå†…å­˜

- æ‰€æœ‰æƒä¸å †æ ˆ
  - å½“ä½ çš„ä»£ç è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼ é€’ç»™å‡½æ•°çš„å‚æ•°ï¼ˆåŒ…æ‹¬å¯èƒ½æŒ‡å‘å †ä¸Šæ•°æ®çš„æŒ‡é’ˆå’Œå‡½æ•°çš„å±€éƒ¨å˜é‡ï¼‰ä¾æ¬¡è¢«å‹å…¥æ ˆä¸­ï¼Œå½“å‡½æ•°è°ƒç”¨ç»“æŸæ—¶ï¼Œè¿™äº›å€¼å°†è¢«ä»æ ˆä¸­æŒ‰ç…§ç›¸åçš„é¡ºåºä¾æ¬¡ç§»é™¤ã€‚
  - å› ä¸ºå †ä¸Šçš„æ•°æ®ç¼ºä¹ç»„ç»‡ï¼Œå› æ­¤è·Ÿè¸ªè¿™äº›æ•°æ®ä½•æ—¶åˆ†é…å’Œé‡Šæ”¾æ˜¯éå¸¸é‡è¦çš„ï¼Œå¦åˆ™å †ä¸Šçš„æ•°æ®å°†äº§ç”Ÿå†…å­˜æ³„æ¼ â€”â€” è¿™äº›æ•°æ®å°†æ°¸è¿œæ— æ³•è¢«å›æ”¶ã€‚è¿™å°±æ˜¯ Rust æ‰€æœ‰æƒç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å¼ºå¤§ä¿éšœã€‚

### æ‰€æœ‰æƒåŸåˆ™
- Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
- ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)

#### å˜é‡ä½œç”¨åŸŸ

ä½œç”¨åŸŸæ˜¯ä¸€ä¸ªå˜é‡åœ¨ç¨‹åºä¸­æœ‰æ•ˆçš„èŒƒå›´ã€‚
```rust
{                      // s åœ¨è¿™é‡Œæ— æ•ˆï¼Œå®ƒå°šæœªå£°æ˜
    let s = "hello";   // ä»æ­¤å¤„èµ·ï¼Œs æ˜¯æœ‰æ•ˆçš„
    // ä½¿ç”¨ s
}                      // æ­¤ä½œç”¨åŸŸå·²ç»“æŸï¼Œsä¸å†æœ‰æ•ˆ
```

æˆ‘ä»¬å·²ç»è§è¿‡å­—ç¬¦ä¸²å­—é¢å€¼ `let s = "hello"`ï¼Œs æ˜¯è¢«ç¡¬ç¼–ç è¿›ç¨‹åºé‡Œçš„å­—ç¬¦ä¸²å€¼ï¼ˆç±»å‹ä¸º &str ï¼‰ã€‚å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯å®ƒå¹¶ä¸é€‚ç”¨äºæ‰€æœ‰åœºæ™¯ã€‚åŸå› æœ‰äºŒï¼š
- å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºè¢«ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­
- å¹¶éæ‰€æœ‰å­—ç¬¦ä¸²çš„å€¼éƒ½èƒ½åœ¨ç¼–å†™ä»£ç æ—¶å¾—çŸ¥

ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²æ˜¯éœ€è¦ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡ç”¨æˆ·åŠ¨æ€è¾“å…¥ç„¶åå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œè¿™ç§æƒ…å†µï¼Œå­—ç¬¦ä¸²å­—é¢å€¼å°±å®Œå…¨æ— ç”¨æ­¦ä¹‹åœ°ã€‚ ä¸ºæ­¤ï¼ŒRust ä¸ºæˆ‘ä»¬æä¾›åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹: Stringï¼Œè¯¥ç±»å‹è¢«åˆ†é…åˆ°å †ä¸Šï¼Œå› æ­¤å¯ä»¥åŠ¨æ€ä¼¸ç¼©ï¼Œä¹Ÿå°±èƒ½å­˜å‚¨åœ¨ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ–‡æœ¬ã€‚
```rust
let mut s = String::from("hello");
s.push_str(", world!"); // push_str() åœ¨å­—ç¬¦ä¸²åè¿½åŠ å­—é¢å€¼
println!("{}", s); // å°†æ‰“å° `hello, world!`
```

### å˜é‡ç»‘å®šèƒŒåçš„æ•°æ®äº¤äº’
```rust
let x = 5;
let y = x;
```
è¿™æ®µä»£ç å¹¶æ²¡æœ‰å‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»ï¼ŒåŸå› å¾ˆç®€å•ï¼š ä»£ç é¦–å…ˆå°† 5 ç»‘å®šåˆ°å˜é‡ xï¼Œæ¥ç€æ‹·è´ x çš„å€¼èµ‹ç»™ yï¼Œæœ€ç»ˆ x å’Œ y éƒ½ç­‰äº 5ï¼Œå› ä¸ºæ•´æ•°æ˜¯ Rust åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæ˜¯å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯é€šè¿‡è‡ªåŠ¨æ‹·è´çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œéƒ½è¢«å­˜åœ¨æ ˆä¸­ï¼Œå®Œå…¨æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚

æ•´ä¸ªè¿‡ç¨‹ä¸­çš„èµ‹å€¼éƒ½æ˜¯é€šè¿‡å€¼æ‹·è´çš„æ–¹å¼å®Œæˆï¼ˆå‘ç”Ÿåœ¨æ ˆä¸­ï¼‰ï¼Œå› æ­¤å¹¶ä¸éœ€è¦æ‰€æœ‰æƒè½¬ç§»ã€‚

```rust
let s1 = String::from("hello");
let s2 = s1;
```

String ç±»å‹æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹ï¼Œç”±å­˜å‚¨åœ¨æ ˆä¸­çš„å †æŒ‡é’ˆã€å­—ç¬¦ä¸²é•¿åº¦ã€å­—ç¬¦ä¸²å®¹é‡å…±åŒç»„æˆï¼Œå…¶ä¸­å †æŒ‡é’ˆæ˜¯æœ€é‡è¦çš„ï¼Œå®ƒæŒ‡å‘äº†çœŸå®å­˜å‚¨å­—ç¬¦ä¸²å†…å®¹çš„å †å†…å­˜

String ç±»å‹æŒ‡å‘äº†ä¸€ä¸ªå †ä¸Šçš„ç©ºé—´ï¼Œè¿™é‡Œå­˜å‚¨ç€å®ƒçš„çœŸå®æ•°æ®ï¼Œä¸‹é¢å¯¹ä¸Šé¢ä»£ç ä¸­çš„ let s2 = s1 åˆ†æˆä¸¤ç§æƒ…å†µè®¨è®ºï¼š
- æ‹·è´ String å’Œå­˜å‚¨åœ¨å †ä¸Šçš„å­—èŠ‚æ•°ç»„ å¦‚æœè¯¥è¯­å¥æ˜¯æ‹·è´æ‰€æœ‰æ•°æ®(æ·±æ‹·è´)ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ String æœ¬èº«è¿˜æ˜¯åº•å±‚çš„å †ä¸Šæ•°æ®ï¼Œéƒ½ä¼šè¢«å…¨éƒ¨æ‹·è´ï¼Œè¿™å¯¹äºæ€§èƒ½è€Œè¨€ä¼šé€ æˆéå¸¸å¤§çš„å½±å“
- åªæ‹·è´ String æœ¬èº« è¿™æ ·çš„æ‹·è´éå¸¸å¿«ï¼Œå› ä¸ºåœ¨ 64 ä½æœºå™¨ä¸Šå°±æ‹·è´äº† 8å­—èŠ‚çš„æŒ‡é’ˆã€8å­—èŠ‚çš„é•¿åº¦ã€8å­—èŠ‚çš„å®¹é‡ï¼Œæ€»è®¡ 24 å­—èŠ‚ï¼Œä½†æ˜¯å¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼Œè¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„æ‰€æœ‰æƒè§„åˆ™å§ï¼Ÿå…¶ä¸­æœ‰ä¸€æ¡å°±æ˜¯ï¼šä¸€ä¸ªå€¼åªå…è®¸æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œè€Œç°åœ¨è¿™ä¸ªå€¼ï¼ˆå †ä¸Šçš„çœŸå®å­—ç¬¦ä¸²æ•°æ®ï¼‰æœ‰äº†ä¸¤ä¸ªæ‰€æœ‰è€…ï¼šs1 å’Œ s2ã€‚

**Rust è¿™æ ·è§£å†³é—®é¢˜ï¼šå½“ s1 è¢«èµ‹äºˆ s2 åï¼ŒRust è®¤ä¸º s1 ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ä¹Ÿæ— éœ€åœ¨ s1 ç¦»å¼€ä½œç”¨åŸŸå drop ä»»ä½•ä¸œè¥¿ï¼Œè¿™å°±æ˜¯æŠŠæ‰€æœ‰æƒä» s1 è½¬ç§»ç»™äº† s2ï¼Œs1 åœ¨è¢«èµ‹äºˆ s2 åå°±é©¬ä¸Šå¤±æ•ˆäº†ã€‚**

```rust
let s1 = String::from("hello");
let s2 = s1;

println!("{}, world!", s1);

===================
error[E0382]: borrow of moved value: `s1`
 --> src/main.rs:5:28
  |
2 |     let s1 = String::from("hello");
  |         -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait
3 |     let s2 = s1;
  |              -- value moved here
4 |
5 |     println!("{}, world!", s1);
  |                            ^^ value borrowed here after move
  |
  = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)
help: consider cloning the value if the performance cost is acceptable
  |
3 |     let s2 = s1.clone();
  |                ++++++++

For more information about this error, try `rustc --explain E0382`.

```

å¦‚æœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ æµ…æ‹·è´(shallow copy) å’Œ æ·±æ‹·è´(deep copy)ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¬èµ·æ¥å°±åƒæµ…æ‹·è´ï¼Œä½†æ˜¯åˆå› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡ s1 æ— æ•ˆäº†ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œè¢«ç§°ä¸º **ç§»åŠ¨(move)**

<img src="https://pic1.zhimg.com/80/v2-3ec77951de6a17584b5eb4a3838b4b61_1440w.jpg">

```rust
fn main() {
    let x: &str = "hello, world";
    let y = x;
    println!("{},{}",x,y);
}
```
è¿™æ®µä»£ç å’Œä¹‹å‰çš„ String æœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼šåœ¨ String çš„ä¾‹å­ä¸­ s1 æŒæœ‰äº†é€šè¿‡String::from("hello") åˆ›å»ºçš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œè¿™ä¸ªä¾‹å­ä¸­ï¼Œx åªæ˜¯å¼•ç”¨äº†å­˜å‚¨åœ¨äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶( binary )ä¸­çš„å­—ç¬¦ä¸² "hello, world"ï¼Œå¹¶æ²¡æœ‰æŒæœ‰æ‰€æœ‰æƒã€‚

#### å…‹éš†(æ·±æ‹·è´)
Rust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€ã€‚å› æ­¤ï¼Œä»»ä½•è‡ªåŠ¨çš„å¤åˆ¶éƒ½ä¸æ˜¯æ·±æ‹·è´ï¼Œå¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚

å¦‚æœæˆ‘ä»¬ç¡®å®éœ€è¦æ·±åº¦å¤åˆ¶ String ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš clone çš„æ–¹æ³•ã€‚

```rust
let s1 = String::from("hello");
let s2 = s1.clone();

println!("s1 = {}, s2 = {}", s1, s2);
```

#### æ‹·è´(æµ…æ‹·è´)
```rust
let x = 5;
let y = x;

println!("x = {}, y = {}", x, y);
```

åƒæ•´å‹è¿™æ ·çš„åŸºæœ¬ç±»å‹åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥å¤§å°çš„ï¼Œä¼šè¢«å­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æ‹·è´å…¶å®é™…çš„å€¼æ˜¯å¿«é€Ÿçš„ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»ºå˜é‡ y åä½¿ x æ— æ•ˆï¼ˆxã€y éƒ½ä»ç„¶æœ‰æ•ˆï¼‰ã€‚æ¢å¥è¯è¯´ï¼Œè¿™é‡Œæ²¡æœ‰æ·±æµ…æ‹·è´çš„åŒºåˆ«ï¼Œå› æ­¤è¿™é‡Œè°ƒç”¨ **clone** å¹¶ä¸ä¼šä¸é€šå¸¸çš„æµ…æ‹·è´æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç”¨ç®¡å®ƒï¼ˆå¯ä»¥ç†è§£æˆåœ¨æ ˆä¸Šåšäº†æ·±æ‹·è´ï¼‰ã€‚

Rust æœ‰ä¸€ä¸ªå«åš Copy çš„ç‰¹å¾ï¼Œå¯ä»¥ç”¨åœ¨ç±»ä¼¼æ•´å‹è¿™æ ·åœ¨æ ˆä¸­å­˜å‚¨çš„ç±»å‹ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ‹¥æœ‰ Copy ç‰¹å¾ï¼Œä¸€ä¸ªæ—§çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åä»ç„¶å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯èµ‹å€¼çš„è¿‡ç¨‹å³æ˜¯æ‹·è´çš„è¿‡ç¨‹ã€‚

- æ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ¯”å¦‚ u32
- å¸ƒå°”ç±»å‹ï¼Œboolï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ false
- æ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œæ¯”å¦‚ f64
- å­—ç¬¦ç±»å‹ï¼Œchar
- å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»å‹ä¹Ÿéƒ½æ˜¯ Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) æ˜¯ Copy çš„ï¼Œä½† (i32, String) å°±ä¸æ˜¯
- ä¸å¯å˜å¼•ç”¨ &T ï¼Œä¾‹å¦‚è½¬ç§»æ‰€æœ‰æƒä¸­çš„æœ€åä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯æ³¨æ„ï¼šå¯å˜å¼•ç”¨ &mut T æ˜¯ä¸å¯ä»¥ Copyçš„


- **ç§»åŠ¨(move)** : ownership å‘ç”Ÿå˜åŒ–
- **å¤åˆ¶(copy)** : æ ˆä¸Šå‘ç”Ÿï¼Œå¤åˆ¶å‡ºå¤šä¸ªå˜é‡ï¼Œä¸æ˜¯ownershipçš„è½¬ç§»
- `clone` deep copy, `copy` shallow copy -> **å¤åˆ¶(copy)**


### å‡½æ•°ä¼ å€¼ä¸è¿”å›
```rust
fn main() {
    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                    // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

    makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                    // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åé¢å¯ç»§ç»­ä½¿ç”¨ x

} // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
```

```rust
fn main() {
    let s1 = gives_ownership();         // gives_ownership å°†è¿”å›å€¼
                                        // ç§»ç»™ s1

    let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ

    let s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                        // takes_and_gives_back ä¸­,
                                        // å®ƒä¹Ÿå°†è¿”å›å€¼ç§»ç»™ s3
} // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

fn gives_ownership() -> String {             // gives_ownership å°†è¿”å›å€¼ç§»åŠ¨ç»™
                                             // è°ƒç”¨å®ƒçš„å‡½æ•°

    let some_string = String::from("hello"); // some_string è¿›å…¥ä½œç”¨åŸŸ.

    some_string                              // è¿”å› some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}

// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›è¯¥å€¼
fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ

    a_string  // è¿”å› a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}
```

## 2.3.2 å¼•ç”¨ä¸å€Ÿç”¨
å¸¸è§„å¼•ç”¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘äº†å¯¹è±¡å­˜å‚¨çš„å†…å­˜åœ°å€ã€‚
```rust
fn main() {
    let x = 5;
    let y = &x;  // y æ˜¯ x çš„å¼•ç”¨

    assert_eq!(5, x);
    assert_eq!(5, *y); // ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ * æ¥è·å–å¼•ç”¨æŒ‡å‘çš„å€¼
}
```

### ä¸å¯å˜å¼•ç”¨

ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬ç”¨ s1 çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ calculate_length å‡½æ•°ï¼Œè€Œä¸æ˜¯æŠŠ s1 çš„æ‰€æœ‰æƒè½¬ç§»ç»™è¯¥å‡½æ•°ï¼š
- æ— éœ€åƒä¸Šç« ä¸€æ ·ï¼šå…ˆé€šè¿‡å‡½æ•°å‚æ•°ä¼ å…¥æ‰€æœ‰æƒï¼Œç„¶åå†é€šè¿‡å‡½æ•°è¿”å›æ¥ä¼ å‡ºæ‰€æœ‰æƒï¼Œä»£ç æ›´åŠ ç®€æ´
- `calculate_length` çš„å‚æ•° s ç±»å‹ä» String å˜ä¸º &String

```rust
fn main() {
    let s1 = String::from("hello");

    let len = calculate_length(&s1);

    println!("The length of '{}' is {}.", s1, len);
}

fn calculate_length(s: &String) -> usize {
    s.len()
}
```

<img src="https://pic1.zhimg.com/80/v2-fc68ea4a1fe2e3fe4c5bb523a0a8247c_1440w.jpg">

é€šè¿‡ &s1 è¯­æ³•ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘ s1 çš„å¼•ç”¨ï¼Œä½†æ˜¯å¹¶ä¸æ‹¥æœ‰å®ƒã€‚å› ä¸ºå¹¶ä¸æ‹¥æœ‰è¿™ä¸ªå€¼ï¼Œå½“å¼•ç”¨ç¦»å¼€ä½œç”¨åŸŸåï¼Œå…¶æŒ‡å‘çš„å€¼ä¹Ÿä¸ä¼šè¢«ä¸¢å¼ƒ
ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹å˜é‡çš„å€¼å‘¢ï¼Ÿæ­£å¦‚å˜é‡é»˜è®¤ä¸å¯å˜ä¸€æ ·ï¼Œå¼•ç”¨æŒ‡å‘çš„å€¼é»˜è®¤ä¹Ÿæ˜¯ä¸å¯å˜çš„.
```rust
fn main() {
    let s = String::from("hello");

    change(&s);
}

fn change(some_string: &String) {
    some_string.push_str(", world");
}

error[E0596]: cannot borrow `*some_string` as mutable, as it is behind a `&` reference
 --> src/main.rs:8:5
  |
7 | fn change(some_string: &String) {
  |                        ------- help: consider changing this to be a mutable reference: `&mut String`
                           ------- å¸®åŠ©ï¼šè€ƒè™‘å°†è¯¥å‚æ•°ç±»å‹ä¿®æ”¹ä¸ºå¯å˜çš„å¼•ç”¨: `&mut String`
8 |     some_string.push_str(", world");
  |     ^^^^^^^^^^^ `some_string` is a `&` reference, so the data it refers to cannot be borrowed as mutable
                     `some_string`æ˜¯ä¸€ä¸ª`&`ç±»å‹çš„å¼•ç”¨ï¼Œå› æ­¤å®ƒæŒ‡å‘çš„æ•°æ®æ— æ³•è¿›è¡Œä¿®æ”¹

```

### å¯å˜å¼•ç”¨
```rust
fn main() {
    let mut s = String::from("hello");

    change(&mut s);
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```

å£°æ˜ s æ˜¯å¯å˜ç±»å‹ï¼Œå…¶æ¬¡åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¼•ç”¨ &mut s å’Œæ¥å—å¯å˜å¼•ç”¨å‚æ•° some_string: &mut String çš„å‡½æ•°ã€‚

#### å¯å˜å¼•ç”¨åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ª

åŒä¸€ä½œç”¨åŸŸï¼Œç‰¹å®šæ•°æ®åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼š
```rust
let mut s = String::from("hello");

let r1 = &mut s;
let r2 = &mut s;

println!("{}, {}", r1, r2);

error[E0499]: cannot borrow `s` as mutable more than once at a time åŒä¸€æ—¶é—´æ— æ³•å¯¹ `s` è¿›è¡Œä¸¤æ¬¡å¯å˜å€Ÿç”¨
 --> src/main.rs:5:14
  |
4 |     let r1 = &mut s;
  |              ------ first mutable borrow occurs here é¦–ä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
5 |     let r2 = &mut s;
  |              ^^^^^^ second mutable borrow occurs here ç¬¬äºŒä¸ªå¯å˜å¼•ç”¨åœ¨è¿™é‡Œå€Ÿç”¨
6 |
7 |     println!("{}, {}", r1, r2);
  |                        -- first borrow later used here ç¬¬ä¸€ä¸ªå€Ÿç”¨åœ¨è¿™é‡Œä½¿ç”¨
```

è¿™ç§é™åˆ¶çš„å¥½å¤„å°±æ˜¯ä½¿ Rust åœ¨ç¼–è¯‘æœŸå°±é¿å…æ•°æ®ç«äº‰ï¼Œæ•°æ®ç«äº‰å¯ç”±ä»¥ä¸‹è¡Œä¸ºé€ æˆï¼š
- ä¸¤ä¸ªæˆ–æ›´å¤šçš„æŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®
- è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®
- æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶

#### å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨

```rust
let mut s = String::from("hello");

let r1 = &s; // æ²¡é—®é¢˜
let r2 = &s; // æ²¡é—®é¢˜
let r3 = &mut s; // å¤§é—®é¢˜

println!("{}, {}, and {}", r1, r2, r3);

error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
        // æ— æ³•å€Ÿç”¨å¯å˜ `s` å› ä¸ºå®ƒå·²ç»è¢«å€Ÿç”¨äº†ä¸å¯å˜
 --> src/main.rs:6:14
  |
4 |     let r1 = &s; // æ²¡é—®é¢˜
  |              -- immutable borrow occurs here ä¸å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
5 |     let r2 = &s; // æ²¡é—®é¢˜
6 |     let r3 = &mut s; // å¤§é—®é¢˜
  |              ^^^^^^ mutable borrow occurs here å¯å˜å€Ÿç”¨å‘ç”Ÿåœ¨è¿™é‡Œ
7 |
8 |     println!("{}, {}, and {}", r1, r2, r3);
  |                                -- immutable borrow later used here ä¸å¯å˜å€Ÿç”¨åœ¨è¿™é‡Œä½¿ç”¨
```

å…¶å®è¿™ä¸ªä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ­£åœ¨å€Ÿç”¨ä¸å¯å˜å¼•ç”¨çš„ç”¨æˆ·ï¼Œè‚¯å®šä¸å¸Œæœ›ä»–å€Ÿç”¨çš„ä¸œè¥¿ï¼Œè¢«å¦å¤–ä¸€ä¸ªäººè«åå…¶å¦™æ”¹å˜äº†ã€‚å¤šä¸ªä¸å¯å˜å€Ÿç”¨è¢«å…è®¸æ˜¯å› ä¸ºæ²¡æœ‰äººä¼šå»è¯•å›¾ä¿®æ”¹æ•°æ®ï¼Œæ¯ä¸ªäººéƒ½åªè¯»è¿™ä¸€ä»½æ•°æ®è€Œä¸åšä¿®æ”¹ï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒæ•°æ®è¢«æ±¡æŸ“ã€‚

Rust çš„ç¼–è¯‘å™¨ä¸€ç›´åœ¨ä¼˜åŒ–ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸè·Ÿå˜é‡ä½œç”¨åŸŸæ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹æ—¥å¸¸ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„å›°æ‰°ï¼Œä½ å¿…é¡»éå¸¸å°å¿ƒçš„å»å®‰æ’å¯å˜ã€ä¸å¯å˜å˜é‡çš„å€Ÿç”¨ï¼Œå…å¾—æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š
```rust
fn main() {
   let mut s = String::from("hello");

    let r1 = &s;
    let r2 = &s;
    println!("{} and {}", r1, r2);
    // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr1,r2ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

    let r3 = &mut s;
    println!("{}", r3);
} // è€ç¼–è¯‘å™¨ä¸­ï¼Œr1ã€r2ã€r3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
  // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
```
**æ–°ç‰ˆç¼–è¯‘å™¨ä¸­å¼•ç”¨ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ä»èŠ±æ‹¬å·å˜æˆæœ€åä¸€æ¬¡ä½¿ç”¨çš„ä½ç½®**

### NLL
å¯¹äºè¿™ç§ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸ºï¼ŒRust ä¸“é—¨èµ·äº†ä¸€ä¸ªåå­— â€”â€” Non-Lexical Lifetimes(NLL)ï¼Œä¸“é—¨ç”¨äºæ‰¾åˆ°æŸä¸ªå¼•ç”¨åœ¨ä½œç”¨åŸŸ(})ç»“æŸå‰å°±ä¸å†è¢«ä½¿ç”¨çš„ä»£ç ä½ç½®ã€‚

è™½ç„¶è¿™ç§å€Ÿç”¨é”™è¯¯æœ‰çš„æ—¶å€™ä¼šè®©æˆ‘ä»¬å¾ˆéƒé—·ï¼Œä½†æ˜¯ä½ åªè¦æƒ³æƒ³è¿™æ˜¯ Rust æå‰å¸®ä½ å‘ç°äº†æ½œåœ¨çš„ BUGï¼Œå…¶å®å°±å¼€å¿ƒäº†ï¼Œè™½ç„¶å‡æ…¢äº†å¼€å‘é€Ÿåº¦ï¼Œä½†æ˜¯ä»é•¿æœŸæ¥çœ‹ï¼Œå¤§å¹…å‡å°‘äº†åç»­å¼€å‘å’Œè¿ç»´æˆæœ¬ã€‚

### æ‚¬å‚å¼•ç”¨(Dangling References)
æ‚¬å‚å¼•ç”¨ä¹Ÿå«åšæ‚¬å‚æŒ‡é’ˆï¼Œæ„æ€ä¸ºæŒ‡é’ˆæŒ‡å‘æŸä¸ªå€¼åï¼Œè¿™ä¸ªå€¼è¢«é‡Šæ”¾æ‰äº†ï¼Œè€ŒæŒ‡é’ˆä»ç„¶å­˜åœ¨ï¼Œå…¶æŒ‡å‘çš„å†…å­˜å¯èƒ½ä¸å­˜åœ¨ä»»ä½•å€¼æˆ–å·²è¢«å…¶å®ƒå˜é‡é‡æ–°ä½¿ç”¨ã€‚åœ¨ Rust ä¸­ç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿å¼•ç”¨æ°¸è¿œä¹Ÿä¸ä¼šå˜æˆæ‚¬å‚çŠ¶æ€ï¼šå½“ä½ è·å–æ•°æ®çš„å¼•ç”¨åï¼Œç¼–è¯‘å™¨å¯ä»¥ç¡®ä¿æ•°æ®ä¸ä¼šåœ¨å¼•ç”¨ç»“æŸå‰è¢«é‡Šæ”¾ï¼Œè¦æƒ³é‡Šæ”¾æ•°æ®ï¼Œå¿…é¡»å…ˆåœæ­¢å…¶å¼•ç”¨çš„ä½¿ç”¨ã€‚


### å€Ÿç”¨è§„åˆ™æ€»ç»“
æ€»çš„æ¥è¯´ï¼Œå€Ÿç”¨è§„åˆ™å¦‚ä¸‹ï¼š
- å¼•ç”¨ä¸ä¼šå¯¼è‡´ownershipå‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šå‘ç”Ÿmoveã€‚
- åŒä¸€æ—¶åˆ»ï¼Œä½ åªèƒ½æ‹¥æœ‰è¦ä¹ˆä¸€ä¸ªå¯å˜å¼•ç”¨ï¼Œè¦ä¹ˆä»»æ„å¤šä¸ªä¸å¯å˜å¼•ç”¨
- å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„

[practice](https://practice-zh.course.rs/ownership/borrowing.html) 


# 2.4 ç¬¦åˆç±»å‹
## 2.4.1 å­—ç¬¦ä¸²å’Œåˆ‡ç‰‡
```rust
fn main() {
  let my_name = "Pascal";
  greet(my_name);
}

fn greet(name: String) {
  println!("Hello, {}!", name);
}

-------------------------
error[E0308]: mismatched types
 --> src/main.rs:3:11
  |
3 |     greet(my_name);
  |           ^^^^^^^
  |           |
  |           expected struct `std::string::String`, found `&str`
  |           help: try using a conversion method: `my_name.to_string()`

error: aborting due to previous error
```

### åˆ‡ç‰‡(slice)

```rust
let s = String::from("hello world");

let hello = &s[0..5];
let world = &s[6..11];
```
åˆ‡ç‰‡å¹¶ä¸æ˜¯ Rust ç‹¬æœ‰çš„æ¦‚å¿µï¼Œåœ¨ Go è¯­è¨€ä¸­å°±éå¸¸æµè¡Œï¼Œå®ƒå…è®¸ä½ å¼•ç”¨é›†åˆä¸­éƒ¨åˆ†è¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸æ˜¯å¼•ç”¨æ•´ä¸ªé›†åˆã€‚

`hello` æ²¡æœ‰å¼•ç”¨æ•´ä¸ª `String s`ï¼Œè€Œæ˜¯å¼•ç”¨äº† s çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼Œé€šè¿‡ [0..5] çš„æ–¹å¼æ¥æŒ‡å®šã€‚
`let world = &s[6..11];` æ¥è¯´ï¼Œworld æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œè¯¥åˆ‡ç‰‡çš„æŒ‡é’ˆæŒ‡å‘ s çš„ç¬¬ 7 ä¸ªå­—èŠ‚(ç´¢å¼•ä» 0 å¼€å§‹, 6 æ˜¯ç¬¬ 7 ä¸ªå­—èŠ‚)ï¼Œä¸”è¯¥åˆ‡ç‰‡çš„é•¿åº¦æ˜¯ 5 ä¸ªå­—èŠ‚

<img src="https://pic1.zhimg.com/80/v2-69da917741b2c610732d8526a9cc86f5_1440w.jpg">

```rust
let s = String::from("hello");
let len = s.len();

let slice = &s[0..2];
let slice = &s[..2];

let slice = &s[4..len];
let slice = &s[4..];

let slice = &s[0..len];
let slice = &s[..];
```

åœ¨å¯¹å­—ç¬¦ä¸²ä½¿ç”¨åˆ‡ç‰‡è¯­æ³•æ—¶éœ€è¦æ ¼å¤–å°å¿ƒï¼Œåˆ‡ç‰‡çš„ç´¢å¼•å¿…é¡»è½åœ¨å­—ç¬¦ä¹‹é—´çš„è¾¹ç•Œä½ç½®ï¼Œä¹Ÿå°±æ˜¯ UTF-8 å­—ç¬¦çš„è¾¹ç•Œï¼Œä¾‹å¦‚ä¸­æ–‡åœ¨ UTF-8 ä¸­å ç”¨ä¸‰ä¸ªå­—èŠ‚ï¼Œä¸‹é¢çš„ä»£ç å°±ä¼šå´©æºƒï¼š
```rust
 let s = "ä¸­å›½äºº";
 let a = &s[0..2];
 println!("{}",a);
```
å› ä¸ºæˆ‘ä»¬åªå– s å­—ç¬¦ä¸²çš„å‰ä¸¤ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æœ¬ä¾‹ä¸­æ¯ä¸ªæ±‰å­—å ç”¨ä¸‰ä¸ªå­—èŠ‚ï¼Œå› æ­¤æ²¡æœ‰è½åœ¨è¾¹ç•Œå¤„ï¼Œä¹Ÿå°±æ˜¯è¿ ä¸­ å­—éƒ½å–ä¸å®Œæ•´ï¼Œæ­¤æ—¶ç¨‹åºä¼šç›´æ¥å´©æºƒé€€å‡ºï¼Œå¦‚æœæ”¹æˆ &s[0..3]ï¼Œåˆ™å¯ä»¥æ­£å¸¸é€šè¿‡ç¼–è¯‘ã€‚ å› æ­¤ï¼Œå½“ä½ éœ€è¦å¯¹å­—ç¬¦ä¸²åšåˆ‡ç‰‡ç´¢å¼•æ“ä½œæ—¶ï¼Œéœ€è¦æ ¼å¤–å°å¿ƒè¿™ä¸€ç‚¹ï¼Œå…³äºè¯¥å¦‚ä½•æ“ä½œ UTF-8 å­—ç¬¦ä¸²ï¼Œå‚è§è¿™é‡Œã€‚

**å­—ç¬¦ä¸²åˆ‡ç‰‡çš„ç±»å‹æ ‡è¯†æ˜¯ `&str`ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è¿™æ ·å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ String ç±»å‹ï¼Œè¿”å›å®ƒçš„åˆ‡ç‰‡ï¼š`fn first_word(s: &String) -> &str `ã€‚**

```rust
fn main() {
    let mut s = String::from("hello world");

    let word = first_word(&s);

    s.clear(); // error!

    println!("the first word is: {}", word);
}
fn first_word(s: &String) -> &str {
    &s[..1]
}

==================
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
  --> src/main.rs:18:5
   |
16 |     let word = first_word(&s);
   |                           -- immutable borrow occurs here
17 |
18 |     s.clear(); // error!
   |     ^^^^^^^^^ mutable borrow occurs here
19 |
20 |     println!("the first word is: {}", word);
   |                                       ---- immutable borrow later used here
```
****
### å­—ç¬¦ä¸²å­—é¢é‡æ˜¯åˆ‡ç‰‡
```rust
let s: &str = "Hello, world!";
```

### ä»€ä¹ˆæ˜¯å­—ç¬¦ä¸²?
**Rust ä¸­çš„å­—ç¬¦æ˜¯ Unicode ç±»å‹ï¼Œå› æ­¤æ¯ä¸ªå­—ç¬¦å æ® 4 ä¸ªå­—èŠ‚å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­ä¸ä¸€æ ·ï¼Œå­—ç¬¦ä¸²æ˜¯ UTF-8 ç¼–ç ï¼Œä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦æ‰€å çš„å­—èŠ‚æ•°æ˜¯å˜åŒ–çš„(1 - 4)**

Rust åœ¨è¯­è¨€çº§åˆ«ï¼Œåªæœ‰ä¸€ç§å­—ç¬¦ä¸²ç±»å‹ï¼š `str`.

- é€šå¸¸æ˜¯ä»¥å¼•ç”¨ç±»å‹å‡ºç° `&str`
- åœ¨æ ‡å‡†åº“é‡Œï¼Œè¿˜æœ‰å¤šç§ä¸åŒç”¨é€”çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå…¶ä¸­ä½¿ç”¨æœ€å¹¿çš„å³æ˜¯ `String`ç±»å‹

### String ä¸ &str çš„è½¬æ¢

- &str åˆ° String
```rust
String::from("hello,world")
"hello,world".to_string()
```

- String åˆ° &str
```rust
fn main() {
    let s = String::from("hello,world!");
    say_hello(&s);
    say_hello(&s[..]);
    say_hello(s.as_str());
}

fn say_hello(s: &str) {
    println!("{}",s);
}
```

### å­—ç¬¦ä¸²ç´¢å¼•
åœ¨å…¶å®ƒè¯­è¨€ä¸­ï¼Œä½¿ç”¨ç´¢å¼•çš„æ–¹å¼è®¿é—®å­—ç¬¦ä¸²çš„æŸä¸ªå­—ç¬¦æˆ–è€…å­ä¸²æ˜¯å¾ˆæ­£å¸¸çš„è¡Œä¸ºï¼Œä½†æ˜¯åœ¨ Rust ä¸­å°±ä¼šæŠ¥é”™ï¼š
```rust
   let s1 = String::from("hello");
   let h = s1[0];
==================
3 |     let h = s1[0];
  |             ^^^^^ `String` cannot be indexed by `{integer}`
  |
  = help: the trait `Index<{integer}>` is not implemented for `String`
```

#### å­—ç¬¦ä¸²å†…éƒ¨ 
å­—ç¬¦ä¸²çš„åº•å±‚çš„æ•°æ®å­˜å‚¨æ ¼å¼å®é™…ä¸Šæ˜¯[ u8 ]ï¼Œä¸€ä¸ªå­—èŠ‚æ•°ç»„, ç”±äºæ˜¯utf-8ç¼–ç ä¸åŒå­—ç¬¦å ç”¨çš„é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç®€å•é€šè¿‡ç´¢å¼•æ¥è®¿é—®å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­—ç¬¦ã€‚


### å­—ç¬¦ä¸²åˆ‡ç‰‡
å‰æ–‡æåˆ°è¿‡ï¼Œå­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯éå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºåˆ‡ç‰‡çš„ç´¢å¼•æ˜¯é€šè¿‡å­—èŠ‚æ¥è¿›è¡Œï¼Œä½†æ˜¯å­—ç¬¦ä¸²åˆæ˜¯ UTF-8 ç¼–ç ï¼Œå› æ­¤ä½ æ— æ³•ä¿è¯ç´¢å¼•çš„å­—èŠ‚åˆšå¥½è½åœ¨å­—ç¬¦çš„è¾¹ç•Œä¸Šï¼Œä¾‹å¦‚ï¼š
```rust
let hello = "ä¸­å›½äºº";

let s = &hello[0..2];
```

### æ“ä½œå­—ç¬¦ä¸²
- è¿½åŠ  (Push)
  ```rust
  fn main() {
      let mut s = String::from("Hello ");

      s.push_str("rust");
      println!("è¿½åŠ å­—ç¬¦ä¸² push_str() -> {}", s);

      s.push('!');
      println!("è¿½åŠ å­—ç¬¦ push() -> {}", s);
  }
  ```
- æ’å…¥ (Insert) : å¯ä»¥ä½¿ç”¨ insert() æ–¹æ³•æ’å…¥å•ä¸ªå­—ç¬¦ charï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ insert_str() æ–¹æ³•æ’å…¥å­—ç¬¦ä¸²å­—é¢é‡
  ```rust
  fn main() {
    let mut s = String::from("Hello rust!");
    s.insert(5, ',');
    println!("æ’å…¥å­—ç¬¦ insert() -> {}", s);
    s.insert_str(6, " I like");
    println!("æ’å…¥å­—ç¬¦ä¸² insert_str() -> {}", s);
  }
  ```
- æ›¿æ¢ (Replace)
  - replace
    ```rust
    fn main() {
      let string_replace = String::from("I like rust. Learning rust is my favorite!");
      let new_string_replace = string_replace.replace("rust", "RUST");
      dbg!(new_string_replace);
    }
    ```
  - replacen
    ```rust
    fn main() {
      let string_replace = "I like rust. Learning rust is my favorite!";
      let new_string_replacen = string_replace.replacen("rust", "RUST", 1);
      dbg!(new_string_replacen);
    }
    ```
  - replace_range : ä»…é€‚ç”¨äº String ç±»å‹
    ```rust
    fn main() {
      let mut string_replace_range = String::from("I like rust!");
      string_replace_range.replace_range(7..8, "R");
      dbg!(string_replace_range);
    }
    ```
- åˆ é™¤ (Delete)
  - pop â€”â€” åˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦
  - remove â€”â€” åˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²ä¸­æŒ‡å®šä½ç½®çš„å­—ç¬¦
  - truncate â€”â€” åˆ é™¤å­—ç¬¦ä¸²ä¸­ä»æŒ‡å®šä½ç½®å¼€å§‹åˆ°ç»“å°¾çš„å…¨éƒ¨å­—ç¬¦
    ```rust
    fn main() {
        let mut string_truncate = String::from("æµ‹è¯•truncate");
        string_truncate.truncate(3);
        dbg!(string_truncate);
    }
    ```
  - clear â€”â€” æ¸…ç©ºå­—ç¬¦ä¸²
    ```rust
    fn main() {
        let mut string_clear = String::from("string clear");
        string_clear.clear();
        dbg!(string_clear);
    }
    ```
  - è¿æ¥ (Concatenate)
    - ä½¿ç”¨ + æˆ–è€… += è¿æ¥å­—ç¬¦ä¸² : è¦æ±‚å³è¾¹çš„å‚æ•°å¿…é¡»ä¸ºå­—ç¬¦ä¸²çš„åˆ‡ç‰‡å¼•ç”¨ï¼ˆSliceï¼‰ç±»å‹
      ```rust
      fn main() {
          let string_append = String::from("hello ");
          let string_rust = String::from("rust");
          // &string_rustä¼šè‡ªåŠ¨è§£å¼•ç”¨ä¸º&str
          let result = string_append + &string_rust;
          let mut result = result + "!"; // `result + "!"` ä¸­çš„ `result` æ˜¯ä¸å¯å˜çš„
          result += "!!!";

          println!("è¿æ¥å­—ç¬¦ä¸² + -> {}", result);
      }
      ```
    - ä½¿ç”¨ format! è¿æ¥å­—ç¬¦ä¸² : format! è¿™ç§æ–¹å¼é€‚ç”¨äº String å’Œ &str
      ```rust
      fn main() {
          let s1 = "hello";
          let s2 = String::from("rust");
          let s = format!("{} {}!", s1, s2);
          println!("{}", s);
      }
      ```
### å­—ç¬¦ä¸²è½¬ä¹‰
æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¬ä¹‰çš„æ–¹å¼ \ è¾“å‡º ASCII å’Œ Unicode å­—ç¬¦ã€‚
```rust
fn main() {
    // é€šè¿‡ \ + å­—ç¬¦çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œè½¬ä¹‰è¾“å‡ºä¸€ä¸ªå­—ç¬¦
    let byte_escape = "I'm writing \x52\x75\x73\x74!";
    println!("What are you doing\x3F (\\x3F means ?) {}", byte_escape);

    // \u å¯ä»¥è¾“å‡ºä¸€ä¸ª unicode å­—ç¬¦
    let unicode_codepoint = "\u{211D}";
    let character_name = "\"DOUBLE-STRUCK CAPITAL R\"";

    println!(
        "Unicode character {} (U+211D) is called {}",
        unicode_codepoint, character_name
    );

    // æ¢è¡Œäº†ä¹Ÿä¼šä¿æŒä¹‹å‰çš„å­—ç¬¦ä¸²æ ¼å¼
    // ä½¿ç”¨\å¿½ç•¥æ¢è¡Œç¬¦
    let long_string = "String literals
                        can span multiple lines.
                        The linebreak and indentation here ->\
                        <- can be escaped too!";
    println!("{}", long_string);
}
```
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä½ ä¼šå¸Œæœ›ä¿æŒå­—ç¬¦ä¸²çš„åŸæ ·ï¼Œä¸è¦è½¬ä¹‰ï¼š
```rust
fn main() {
    println!("{}", "hello \\x52\\x75\\x73\\x74");
    let raw_str = r"Escapes don't work here: \x3F \u{211D}";
    println!("{}", raw_str);

    // å¦‚æœå­—ç¬¦ä¸²åŒ…å«åŒå¼•å·ï¼Œå¯ä»¥åœ¨å¼€å¤´å’Œç»“å°¾åŠ  #
    let quotes = r#"And then I said: "There is no escape!""#;
    println!("{}", quotes);

    // å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å« # å·ï¼Œå¯ä»¥åœ¨å¼€å¤´å’Œç»“å°¾åŠ å¤šä¸ª # å·ï¼Œæœ€å¤šåŠ 255ä¸ªï¼Œåªéœ€ä¿è¯ä¸å­—ç¬¦ä¸²ä¸­è¿ç»­ # å·çš„ä¸ªæ•°ä¸è¶…è¿‡å¼€å¤´å’Œç»“å°¾çš„ # å·çš„ä¸ªæ•°å³å¯
    let longer_delimiter = r###"A string with "# in it. And even "##!"###;
    println!("{}", longer_delimiter);
}
```

### æ“ä½œ UTF-8 å­—ç¬¦ä¸²
```rust
for c in "ä¸­å›½äºº".chars() {
    println!("{}", c);
}

for b in "ä¸­å›½äºº".bytes() {
    println!("{}", b);
}
```

### å­—ç¬¦ä¸²æ·±åº¦å‰–æ

ä¸ºå•¥ String å¯å˜ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢å€¼ str å´ä¸å¯ä»¥ï¼Ÿ

- &str : æˆ‘ä»¬åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å…¶å†…å®¹ï¼Œæœ€ç»ˆå­—é¢å€¼æ–‡æœ¬è¢«ç›´æ¥ç¡¬ç¼–ç è¿›å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™ä½¿å¾—å­—ç¬¦ä¸²å­—é¢å€¼å¿«é€Ÿä¸”é«˜æ•ˆï¼Œè¿™ä¸»è¦å¾—ç›Šäºå­—ç¬¦ä¸²å­—é¢å€¼çš„ä¸å¯å˜æ€§
- String: å¯¹äº String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ã€å¯å¢é•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶å®Œæˆçš„ï¼š
  - é¦–å…ˆå‘æ“ä½œç³»ç»Ÿè¯·æ±‚å†…å­˜æ¥å­˜æ”¾ String å¯¹è±¡
  - åœ¨ä½¿ç”¨å®Œæˆåï¼Œå°†å†…å­˜é‡Šæ”¾ï¼Œå½’è¿˜ç»™æ“ä½œç³»ç»Ÿ

### Practice
- [å­—ç¬¦ä¸²](https://practice-zh.course.rs/compound-types/string.html)
- [åˆ‡ç‰‡](https://practice-zh.course.rs/compound-types/slice.html)
- [String](https://practice-zh.course.rs/collections/string.html)